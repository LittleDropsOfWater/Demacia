#   小程序
微信作为混合app
小程序的业务逻辑跟web差不多，但小程序存在大量的api

##   结构
只分四部分
标签 
样式
脚本
配置(json文件，配置页面的颜色，上拉下拉)
可借助webpack，将标签、样式、脚本使用web开发方式开发
##   工具 mpvue

##   特点
小程序一般只有1级路由。
不能分享小程序到朋友圈，只能分享小程序码
app把小程序分享到微信群聊

##   周边
支付宝小程序，微信小程序

##   预期目标
了解原理，记住**流程**
做到面向文档编程

做两个小程序：
一面而就，电商
##   开发
域名 服务器 后台
###   共同开发
微信给与开发权限，  实现拥有登录权限

####   场景值
可以从各种地方进入小程序,所以需要场景值来辨别区分
####   路由
数组,入口为数组第一项
###   发布
打包完是一个包,点击上传即可
###   AppID
ID是唯一的

##   详情
###   线上最低基础库
基于最低的版本进行开发
###   上传代码时样式自动补全
sass 进行预编译
postCss后处理
补全样式前缀
兼容多种浏览器内核
###   上传代码时自动压缩混淆
压缩:去掉注释,换行,空格
混淆:使源码不可读,不可逆操作
开发者可依靠source-map进行映射

##   开发
工具:MPVUE 开发

请求:flyio
状态管理:vuex


##   微信生态
 - 公众号
   - 服务号 (公司,个体工商户,有支付功能,一个月推四次)
   - 订阅号 (私人,无支付功能,一天推送一次)
 - 小程序
   - openID 为每个访问的账号生成openid,标识用户(公众号和用户生成一个唯一的id)(需要授权)(一个人在多个公众号有多个open id)
  - union_ID 每个账户在同一个公司(微信开发者平台)之下所有小程序,服务号,订阅号的unionID一致
##   登录
拿到用户的openID
wx.login 
不需要授权,在一开始获取.
将openID追加在拦截器里, 每个请求都带上openID.

:用户名和头像授权和登录无关.
##   手机号解密
###   授权
授权之后才能拿到手机号
最好只用授权一次
点击触发弹窗
 - 确认  调接口
 - 取消  跳往设置页面

###   解密
解密需要session_key

getSetting 判断用户是否授权
openSetting
getUserInfo
 - rawData
 - signature
 - encryptedData
###   步骤
1. wx.getSetting 获取用户已经有的授权

2. 判断用户是否授权?
	2.1 授权了, 调用wx.getUserInfo获取用户信息
	2.2 未授权, 调用wx.authorize({
		scode: 'scope.userInfo',
		success: ()=>{
			wx.getUserInfo();
		},
		fail: ()=>{
			wx.openSetting();
		}
	}
	2.2.1 授权成功，获取用户信息
	2.2.2 拒绝授权，获取用户信息失败
		2.2.2.1 打开设置页,让用户去设置

wx.login  => code 

/user/code2session  code =>  openid

wx.getSetting 

##   模板消息通知
form_id
用户做一次支付或提交一次表单,会获取一次form_id
依托小程序接口,携带form_id和关键字
设定时间一个小时之前提示
crotab定时脚本  
##指南
小程序运行环境
|运行环境|逻辑层|渲染层|
|-|-|
|iOS|JAvascriptCore|WKWebView|
|安卓|V|chromium定制内核|
|小程序开发者工具|NWJS|Chrome WebView|

NWJS 开发桌面的应用  PC端应用 .exe
electron 前身NWJS

###开发流程
申请小程序账号
安装开发者工具 配置项目
打包上线
###代码构成
####JSON配置
####小程序配置app。json
路由，上拉下拉，标题
####WXML模板
####WXML样式
####JS逻辑交互
####API
混合开发模式
web开发的同时，借助微信小程序的API
web开发
	优点：迭代快
	缺点：体验差
APP开发
	优点：体验好
	缺点：迭代慢，审核时间长
区别
	web：进度条， 单页面应用只有首页有
###宿主环境
###目录结构
###配置小程序
全局配置
页面配置
sitemap配置
###小程序框架
###小程序UI库
IView Weapp
###插件
SDK 插件
###开发功能
####小程序登录
登录获取 code
code2sessioin 换取openid 和sessionkey
####UnionID机制说明
同一用户，同一微信开放平台帐号下的不同应用，unionid是相同的。
信息同步很有用
####授权
####获取手机号
####生物认证
##小程序跳转方式（五种）
switchTab
reLaunch
redirectTo
navigateto
navigateback
## 支付功能
- 预支付
- 支付过程 第三方SDK
- 通知前端
- 通知后端
![小程序支付流程](miniAppPayment.jpg)
### 前端要做的事
向后台发起请求，
请求成功，
	返回五个参数，
调用微信支付api接口，
请求成功，
	显示支付结果
### 预支付
	下单的过程，需要的是金额
	后端向微信请求，返回预支付信息(prepay_id)
### 支付过程

wx.requestPayment(Object object)
